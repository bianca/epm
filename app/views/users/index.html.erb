<% title 'Find Users' %>

<%= form_tag users_path, method: :get do %>
  <%= select_tag :role, options_for_select(Role.names.map{|n, v| n.pluralize.capitalize}.unshift(['Everyone', nil]), @role) %>
  <% content_for :js_ready do %>
    $('select').change(function(){
      $(this).closest('form').submit();
    });
  <% end %>
  <%= text_field_tag :q, @q, placeholder: 'Name or email' %>
  <%= submit_tag 'Search' %>
<% end %>

<% if @users.any? %>
  <h2><%= pluralize @users.count, 'User' %></h2>
  <%= link_to 'Export these users', users_path(format: 'csv' ) %>
  <ul class="users">
    <% @users.each do |user| %>
      <%= render 'user', user: user, tag: 'li' %>
    <% end %>
  </ul>
<% else %>
  <p>No users found.</p>
<% end %>