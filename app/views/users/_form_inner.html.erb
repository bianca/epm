<%= start_cols %>
<% if user.new_record? %>
  <fieldset>
    <!--<legend>How do you want to participate in Not Far From the Tree?</legend>-->
    <label style="margin:0 0.7em"><%= f.check_box  :participate_in_picks %>I want to pick fruit</label>
    <br />
    <label style="margin:0 0.7em"><%= f.check_box  :add_trees %>I want to sign up a tree to be picked</label>
  </fieldset>
<% end %>

<h1>Your NFFTT Login Info</h1>
<fieldset>
  <legend>Name <%= required %></legend>
  <%= f.text_field :fname, placeholder: 'First' %> &nbsp; &nbsp; &nbsp;
  <%= f.text_field :lname, placeholder: 'Last' %>
</fieldset>

<% if user.new_record? %>
  <fieldset>
    <legend>Password  <%= required %></legend>
    <%= f.password_field :password, placeholder: 'password' %><br>
    <%= f.password_field :password_confirmation, placeholder: 'repeat password' %>
  </fieldset>
<% end %>

<%= end_cols %>


<div id="contact_information" class="block">
<%= start_cols %>


  <h1>Contact Information</h1>
  <div class="field">
    <%= f.label :email %> <%= required %><br>
    <%= f.email_field :email %>
  </div>

  <div class="field">
    <%= f.label :phone %>  <%= required %><br>
    <%= f.phone_field :phone %>
  </div>

    <% if user.new_record? %>
      <div>
      <label style="font-weight:normal">
        <%= check_box_tag :add_to_mailing_list, true, false %>
        Sign me up for Not Far From The Tree’s e-newsletter
      </label>
      </div>
    <% end %>       
    <% if !user.new_record? %>
        <br />
        You can tell me about <%=Configurable.event %> by:
        <div style="margin-left: 20px">
          <label style="font-weight:normal">
            <%= f.check_box :can_email %>
            <b>Email</b>
          </label>
        </div>
        <div style="margin-left: 20px">
          <label style="font-weight:normal">
            <%= f.check_box :can_mail %>
            <b>Mail</b>
          </label>
        </div>
        <div style="margin-left: 20px">
          <label style="font-weight:normal">
            <%= f.check_box :can_phone %>
            <b>Phone</b>
          </label>
        </div>
      <% end %>        
 
    <div class="field">
      <%= f.label :contactnotes, "Additional Contact Information" %> <br>
      <i>Do you have an alternate email address or phone number? Is there someone we should contact if we can’t reach you?</i>
      <%= f.text_area :contactnotes %>
    </div>
<%= next_col %>

<script language="">
  var active_wards = <% if Configurable.active_wards.present? %> <%=Configurable.active_wards.split(",").to_json.html_safe %> <% else %> [] <% end %>
  $(document).ready(function () {
    <% if action_name == "new" %>
      $("#ladderSection").hide();
      $("#propertyNotesSection").hide();
    <% end %>
      $("#user_add_trees").change(function (evt) {
          var isChecked = $(evt.currentTarget).prop("checked");
          if (!!isChecked) {
            $("#ladderSection").show();
            $("#propertyNotesSection").show();
          } else {
            $("#ladderSection").hide();
            $("#propertyNotesSection").hide();
          }
      })

      $("[name='user[home_ward]']").change(function (evt) {
        var ward = evt.currentTarget.value;
        $("#ward_"+ward)[0].checked = true;
        if ($.inArray(ward.toString(), active_wards) != -1) {
          $("#inactive_ward_message").hide()
        }
        else {
         $("#inactive_ward_message").show() 
        }
      });
      $("#inactive_ward_message").hide()
  });
</script>
  <div>
    <%= f.label :home_ward, style: 'font-weight:normal' %>
    <%= f.collection_select :home_ward, Ward.all, :id, :name, include_blank: true %>
    <span class="hint"><%= link_to 'ward map', 'http://app.toronto.ca/wards/jsp/wards.jsp' %></span>
    <div id="inactive_ward_message" class="note">
        Aw! We don't serve your ward yet, but please go ahead and sign up! We're expanding every season, and we'll be sure to email you when we land in your ward!
    </div>
  </div>


<%= render layout: 'shared/address_form', locals: { f: f } do %>
  <div><%= f.check_box :snail_mail %> <%= f.label :snail_mail, style: 'font-weight:normal' %></div>
<% end %>
<% content_for :js_ready do %>
  $("#bad_geocode").hide();
<% end %>
<div id="bad_geocode" class="note">
  We couldnt find that address on a map. Could you put directions below and a street address (e.g. 123 Yonge St. Toronto, ON) above? 
</div>

<fieldset id="propertyNotesSection">
<div class="field">
  <%= f.label :propertynotes, "Is there anything we should be aware of while on the property for the pick?" %>  <br>
  <%= f.text_area :propertynotes %>
</div>
</fieldset>
<fieldset id="ladderSection">
  <legend>Do you have a ladder we can borrow for the pick?</legend> 
  <i>We transport equipment by bicycle so we often aren’t able to bring a ladder.</i><br/>
    <label style="margin:0 0.7em"><%= f.radio_button :ladder, :yes %>Yes</label>
    <label style="margin:0 0.7em"><%= f.radio_button :ladder, :borrow %>I can borrow one from a neighbour</label>
    <label style="margin:0 0.7em"><%= f.radio_button :ladder, :no %>No</label>
</fieldset>

<%= end_cols %>

</div>

<% if Ward.any? %>
  <script language="">
    $(document).ready(function () {
        if ($("#user_participate_in_picks").prop("checked") == false) {
          $("#wards").hide()
        }
        $("#user_participate_in_picks").change(function (evt) {
            if ($(this).prop("checked") == true) {
              $("#wards").show()           
            } else {
              $("#wards").hide()      
            }

        })
    })
  </script>
  <fieldset id="wards">
    <legend>My Wards</legend>
    <p class="hint">
      You will be invited by email to <%= Configurable.event.pluralize %> in the wards you select.<br>
      Wards in <span style="color:gray">grey</span> will have few/no <%= Configurable.event.pluralize %> this year, but may have more in the future.
    </p>
    <%= hidden_field_tag "user[ward_ids][]" %>
    <%= start_cols %>

    <%= start_cols %>
    <% Ward.all.each_with_index do |ward, i| %>
      <%= next_col if i % 22 == 0 %>
      <label<%= ' style="color:gray"'.html_safe unless ward.active? %>>
        <%= check_box_tag "user[ward_ids][]", ward.id, @user.ward_ids.include?(ward.id), id: "ward_#{ward.id}" %>
        <%= ward.name %>
      </label>
    <% end %>
    <%= end_cols %>

    <%= next_col %> 

    <a href="http://app.toronto.ca/wards/jsp/wards.jsp" style="display:block;text-align:right">
      <img src="http://www.toronto.ca/wards2000/images/wards_keymap.gif" width="602" height="334" alt="map of Toronto wards">
      <br>
      Check which ward you live in
    </a>

    <%= end_cols %>
  </fieldset>

<% if current_user.present? %>
  <% if current_user.has_role?(:admin) %>
    <div class="field">
      <%= f.label :admin_notes %> <br>
      <%= f.text_area :admin_notes %>
    </div>
  <% end %>
<% end %>


<% if action_name == "edit" && (current_user.has_role?(:admin) || current_user.id == @user.id) %>
    <div class="field">
      If you do not want to be contacted anymore, please explain why:<br>
      <%= f.text_area :do_not_contact_reason %>
    </div>
<% end %>


<% end %>