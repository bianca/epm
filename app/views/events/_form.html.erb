<%= form_for @event do |f| %>

  <%= render 'shared/errors', thing: @event %>

  <%= start_cols %>

  <div class="field">
    <%= f.label :name %><br>
    <%= f.text_field :name %>
  </div>

  <div class="field">
    <%= f.label :description %><br>
    <%= f.text_area :description %>
  </div>

  <% coordinators = current_user.has_role?(:admin) ? User.coordinators : User.coordinators.where(id: current_user.id) %>
  <div class="field">
    <%= f.label :coordinator_id %><br>
    <%= f.collection_select :coordinator_id, coordinators, :id, :display_name, include_blank: true %>
  </div>

  <%= next_col %>

  <fieldset style="width:14em">
    <legend>When</legend>
    <%= f.label :start_day, 'Date' %><br>
    <%= f.date_field :start_day, value: @event.start.present? ? @event.start.to_date.to_s : nil %>
    <% content_for :js_ready do %>
      $('#event_start_day').after('<div id="datepicker"></div>')
      $('#datepicker').datepicker({
        dateFormat: 'yy-mm-dd',
        nextText: '»',
        prevText: '«',
        onSelect: function(dateText) {
          $('#event_start_day').val(dateText);
        }
      });
      if (!$('#event_start_day').val()) { // if there's no date, don't show today selected
        $('#datepicker .ui-state-active').removeClass('ui-state-active');
      }
    <% end %>

    <div class="field">
      <%= f.label :start_time, 'Time' %>
      <%= f.time_field :start_time, step: 60, value: (@event.start || Time.at((Time.zone.now.to_f / 3600).round * 3600)).strftime('%T.%L') %>
    </div>
    <div class="field">
      <%= f.label :duration, 'For' %>
      <%= f.select :duration, options_for_select((1..6).map{|n| [pluralize(n, 'hour'), n.hours]}, @event.duration) %>
    </div>
  </fieldset>

  <%= end_cols %>

  <%= f.submit 'Save' %>

<% end %>